(function(a,b){'object'==typeof exports&&'object'==typeof module?module.exports=b():'function'==typeof define&&define.amd?define([],b):'object'==typeof exports?exports.Civ5Save=b():a.Civ5Save=b()})(this,function(){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,b),e.l=!0,e.exports}var c={};return b.m=a,b.c=c,b.d=function(a,c,d){b.o(a,c)||Object.defineProperty(a,c,{configurable:!1,enumerable:!0,get:d})},b.n=function(a){var c=a&&a.__esModule?function(){return a['default']}:function(){return a};return b.d(c,'a',c),c},b.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},b.p='',b(b.s=0)}([function(a,b,c){'use strict';function d(a,b){return a.length==b.length&&a.every(function(a,c){return a===b[c]})}function e(a){return'undefined'==typeof a||null===a}var f=String.fromCharCode;Object.defineProperty(b,'__esModule',{value:!0});var g=c(1),h=c.n(g);class i{constructor(a){this.saveData=new j(a.buffer),this.verifyFileSignature(),this.properties=this.getProperties()}static async fromFile(a){let b=await i.loadData(a);return new i(b)}static loadData(a){return new Promise(function(b,c){let d=new FileReader;d.onload=function(){b(new DataView(d.result))},d.onerror=function(){c(d.error)},d.readAsArrayBuffer(a)})}verifyFileSignature(){if('CIV5'!==this.saveData.getString(0,4))throw new Error('File signature does not match. Is this a Civ 5 savegame?')}getProperties(){let a='',b=0,c=new Map,d=this.getSectionOffsets();for(let f in h.a){let g=Object.assign({},h.a[f]),i=this.getPropertySection(g);if(e(i))continue;let j=null;if(i===b){let b=c[a];j=b.byteOffset+b.length}else j=d[i-1].start+g.byteOffsetInSection;c[f]=k.fromType(g.type,j,g.length,this.saveData),a=f,b=i}return c}getSectionOffsets(){const a=[64,0,0,0];let b=new Int8Array(this.saveData.buffer),c=[];return c.push({start:0}),b.forEach((e,f)=>{if(d(b.slice(f,f+4),a)){c.push({start:f}),c[c.length-2].end=f-1}}),c}getPropertySection(a){var b=Number.parseInt;let c=null;for(let d in a.sectionByBuild)b(this.gameBuild)>=b(d)&&(c=a.sectionByBuild[d]);return c}get gameBuild(){return e(this._gameBuild)&&(this._gameBuild=this.getGameBuild()),this._gameBuild}getGameBuild(){const a='FINAL_RELEASE',b=function(){let b=[];for(let c=0;c<a.length;c++)b.push(a.charCodeAt(c));return b}();let c=0,e=new Int8Array(this.saveData.buffer);for(let a=0;a<=e.length;a++)if(d(e.slice(a,a+b.length),b)){c=a;break}let g='',h=c-2;for(;0!==e.slice(h,h+1)[0];)g=f(e.slice(h,h+1))+g,h--;return g}get gameVersion(){if(this.properties.hasOwnProperty('gameVersion'))return this.properties.gameVersion.value}get currentTurn(){return this.properties.currentTurn.value}get player1Civilization(){return this.properties.player1Civilization.value}get difficulty(){return this.properties.difficulty.value}get startingEra(){return this.properties.startingEra.value}get currentEra(){return this.properties.currentEra.value}get gamePace(){return this.properties.gamePace.value}get mapSize(){return this.properties.mapSize.value}get mapFile(){return this.properties.mapFile.value}get maxTurns(){return this.properties.maxTurns.value}set maxTurns(a){this.properties.maxTurns.value=a}get timeVictory(){return this.properties.timeVictory.value}set timeVictory(a){this.properties.timeVictory.value=a}get scienceVictory(){return this.properties.scienceVictory.value}set scienceVictory(a){this.properties.scienceVictory.value=a}get dominationVictory(){return this.properties.dominationVictory.value}set dominationVictory(a){this.properties.dominationVictory.value=a}get culturalVictory(){return this.properties.culturalVictory.value}set culturalVictory(a){this.properties.culturalVictory.value=a}get diplomaticVictory(){return this.properties.diplomaticVictory.value}set diplomaticVictory(a){this.properties.diplomaticVictory.value=a}}b['default']=i;class j extends DataView{getBoolean(a){return!!this.getInt8(a)}setBoolean(a,b){this.setInt8(a,+b)}getString(a,b){let c='';for(let d=a;d<a+b;d++)c+=f(this.getInt8(d));return c}}class k{constructor(a,b,c){this.byteOffset=a,this._length=b,this.saveData=c}get length(){return this._length}static fromType(a,b,c,d){switch(a){case'bool':return new l(b,1,d);case'bytes':return new k(b,c,d);case'int':return new m(b,4,d);case'string':return new n(b,c,d);default:throw new Error(`Property type ${a} not handled`);}}}class l extends k{get value(){return this.saveData.getBoolean(this.byteOffset)}set value(a){this.saveData.setBoolean(this.byteOffset,a)}}class m extends k{get value(){return this.saveData.getInt32(this.byteOffset,!0)}set value(a){this.saveData.setInt32(this.byteOffset,a,!0)}}class n extends k{get length(){return e(this._length)&&(this._length=this.getStringLength(this.byteOffset)+4),this._length}get value(){return this.saveData.getString(this.byteOffset+4,this.length-4)}getStringLength(a){return this.saveData.getInt32(a,!0)}}},function(a){a.exports={fileSignature:{byteOffsetInSection:0,length:4,sectionByBuild:{201080:1},type:'string'},saveGameVersion:{byteOffsetInSection:4,length:4,sectionByBuild:{201080:1},type:'int'},gameVersion:{byteOffsetInSection:8,length:null,sectionByBuild:{341540:1},type:'string'},gameBuild:{byteOffsetInSection:null,length:null,sectionByBuild:{341540:1},type:'string'},currentTurn:{byteOffsetInSection:null,length:4,sectionByBuild:{201080:1},type:'int'},section1Skip1:{_comment:'\'Game mode?\' (https://github.com/urbanski/010_Civ5Save/blob/master/civ5.bt#L25)',byteOffsetInSection:null,length:1,sectionByBuild:{201080:1},type:'bytes'},player1Civilization:{byteOffsetInSection:null,length:null,sectionByBuild:{201080:1},type:'string'},difficulty:{byteOffsetInSection:null,length:null,sectionByBuild:{201080:1},type:'string'},startingEra:{byteOffsetInSection:null,length:null,sectionByBuild:{201080:1},type:'string'},currentEra:{byteOffsetInSection:null,length:null,sectionByBuild:{201080:1},type:'string'},gamePace:{byteOffsetInSection:null,length:null,sectionByBuild:{201080:1},type:'string'},mapSize:{byteOffsetInSection:null,length:null,sectionByBuild:{201080:1},type:'string'},mapFile:{_comment:'The map file appears multiple times; I have no idea why (see section19Map)',byteOffsetInSection:null,length:null,sectionByBuild:{201080:1},type:'string'},section19Skip1:{byteOffsetInSection:264,length:null,sectionByBuild:{201080:17,341540:18,395070:19},type:'string'},section19Skip2:{byteOffsetInSection:null,length:7,sectionByBuild:{201080:17,341540:18,395070:19},type:'bytes'},section19Map:{byteOffsetInSection:null,length:null,sectionByBuild:{201080:17,341540:18,395070:19},type:'string'},section19Skip3:{byteOffsetInSection:null,length:4,sectionByBuild:{201080:17,341540:18,395070:19},type:'bytes'},maxTurns:{byteOffsetInSection:null,length:4,sectionByBuild:{201080:17,341540:18,395070:19},type:'int'},section29Timer1:{byteOffsetInSection:269,length:null,sectionByBuild:{201080:28,395070:29},type:'string'},section29Skip1:{byteOffsetInSection:null,length:12,sectionByBuild:{201080:28,395070:29},type:'bytes'},section29TurnTimer:{byteOffsetInSection:null,length:null,sectionByBuild:{201080:28,395070:29},type:'string'},section29TxtKeyTurnTimer:{byteOffsetInSection:null,length:null,sectionByBuild:{201080:28,395070:29},type:'string'},section29Timer2:{byteOffsetInSection:null,length:null,sectionByBuild:{201080:28,395070:29},type:'string'},section29Skip2:{byteOffsetInSection:null,length:25,sectionByBuild:{201080:28,395070:29},type:'bytes'},timeVictory:{byteOffsetInSection:null,length:1,sectionByBuild:{201080:28,395070:29},type:'bool'},scienceVictory:{byteOffsetInSection:null,length:1,sectionByBuild:{201080:28,395070:29},type:'bool'},dominationVictory:{byteOffsetInSection:null,length:1,sectionByBuild:{201080:28,395070:29},type:'bool'},culturalVictory:{byteOffsetInSection:null,length:1,sectionByBuild:{201080:28,395070:29},type:'bool'},diplomaticVictory:{byteOffsetInSection:null,length:1,sectionByBuild:{201080:28,395070:29},type:'bool'}}}])});